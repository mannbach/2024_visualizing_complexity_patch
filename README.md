# PATCH
## Visualization Complexity Science Workshop 2024
This project contains the code to produce, analyze and plot the networks created by `PATCH`, a network model of [P]referential [A]ttachment, [T]riadic [C]losure and [H]omophily.
This is an interface that simplifies the interaction with the [NetIn software package](https://cshvienna.github.io/NetworkInequalities/) for the participants of [Visualizing Complexity Science Workshop 2024](https://vis.csh.ac.at/vis-workshop-2024/) hosted at the [Complexity Science Hub](https://csh.ac.at).
Check the workshop's [work package page](https://vis.csh.ac.at/vis-workshop-2024/workpackage.html) to download the data.

## Requirements
To run the code in this repository, install the packages in `requirements.txt`.
It is advisable to create a virtual environment to not interfere with other local python installations.
For instance, you can setup a virtual environment using [Conda](https://conda.io/projects/conda/en/latest/user-guide/getting-started.html) as follows:
```bash
conda create --name patch
```
Activate this environment by running ```conda activate patch``` and then install the packages by executing:
```bash
pip install -r requirements.txt
```
You should now be able to run the local code.
Running
```bash
python -c "import patch_workshop; print(patch_workshop.__version__)"
```
should terminate without an error and print the local package version.

## The project
We explain the code structure by the folder tree
```
├── README.md  # this file
├── data  # folder containing data
│   └── graphs  # folder containing raw graphs if present
├── notebooks  # jupyter notebooks
│   └── plot_line_plots.ipynb  # create line plots of presentation
│   └── visualize_graph.ipynb  # creates or loads and visualizes a graph
├── patch_workshop  # local project containing helper functions
│   ├── constants.py  # constant strings and values
│   ├── homophily_metrics.py  # function to compute EI index
│   ├── inequality_metrics.py  # inequality metrics
│   ├── stats.py # function to compute CDFs
│   └── utils.py  # helpful functions to load/store and create graphs
├── plots  # folder that contains output plots
├── requirements.txt  # software packages
├── scripts  # scripts to compute and transform aggregate statistics
│   ├── generate_graphs_and_statistics.py # creates graphs and its statistics
│   └── transform_aggregate_statistics.py
└── setup.py
```

### data
The data folder should contain the aggregated statistics and raw networks (in sub-folder `graphs/`).
Aggregated statistics are provided as a `.csv`-file with the following columns
- Parameters
    - `global`: the global link formation mechanism. Values can be found in `utils/constants.py`.
    - `local`the local link formation mechanism (for triadic closure links). Values can be found in `utils/constants.py`.
    - `h`: the homophily parameters. Higher `h` means that nodes prefer to connect to nodes of the same group.
    - `tc`: the triadic closure probability. Higher values mean that more links will be formed according to the `local` link formation mechanism.
    - `r`: the realization (typically multiple simulation runs are executed).
- Network metrics
    - `gini`: the global degree inequality. Higher values indicate that degrees are distributed unequally: few nodes have most of the links.
    - `ei`: network segregation. Values towards `-1` indicate a segregated network in which nodes connect mainly to their own group. Values close to `+1` indicate the opposite.
    - `stoch_dom`: the inequity in terms of the minority. Values close to `+1` indicate that the minority generally has higher degrees than the majority group.

The graphs are stored as a zipped file (typically as `data/graphs/graphs.tar.gz`).
Run ```tar -xf data/graphs/graphs.tar.gz``` to extract the graph files.
Each graph is contained in a [JSON](https://de.wikipedia.org/wiki/JavaScript_Object_Notation) generated by NetworkX (see [docs](https://networkx.org/documentation/stable/reference/readwrite/json_graph.html) for details and [this link](https://gist.github.com/mbostock/4062045) for an example using D3).
The paramters used to create each graphs can be found in the file name or as values in the respective files.
The structure of each JSON file is explained by the example of `data/graphs/N-200_m-2_f-0.3_h-0.2_tc-0.0_lfm-l-homophily_lfm-g-homophily_r-0.json`:

```json
{
    "directed": false, // Always false because we consider undirected graphs only
    "multigraph": false, // Always false
    "graph": { // Global graph attributes, holding the parameterization
        "class_attribute": "m", // Always “m”, the name of the minority attribute
        "class_values": [0, 1], // Always [0, 1]; minority attribute values
        "class_labels": ["M", "m"], // Always [“M”, “m”]; minority attribute labels
        // The model paramters
        "n": 200,
        "f_m": 0.3,
        "seed": 593068225,
        "tc": 0.0,
        "k": 2,
        "h": 0.2,
        "lfm_l": "homophily",
        "lfm_g": "homophily",
        "realization": 0,
        "model": "TCH", // Legacy attribute, replaced by LFMs
        "tc_uniform": false, // Legacy attribute, replaced by LFMs
    },
    "nodes": [ // List of nodes with minority status
        // Nodes with id "id" and minority status "m", e.g.:
        {"m": 0, "id": 0}
    ],
    "links": [ // List of link objects
        // Each object contains the two node IDs of the link, e.g.:
        {"source": 0, "target": 1}
    ]
}
```
See [notebooks](#notebooks) for examples how to load these datasets and [scripts](#scripts) to create your own data.

### notebooks
Contains useful notebooks that create the plots shown in the presentation and highlight how to create networks using `PATCH`.
You can run a local jupyter server by running ```jupyter notebook``` in your terminal and the open the presented weblink in your browser to run the notebooks (see [documentation](https://docs.jupyter.org/en/latest/) for details).

### patch_workshop
This folder has general functions that simplify the interaction with the created data and the [NetIn package](https://cshvienna.github.io/NetworkInequalities/).
They can be imported in an arbirtrary Python script as (see [notebooks](#notebooks) for examples):
```python
from patch_workshop.utils import create_graph
```

### scripts
Contains Python scripts to simulate many networks, as well as code to compute and translate the aggregate statistics required to produces the presented plots.
The aggregated statistics will also be provided as a `.csv`-file to the participants of the workshop.
A small subset of 30 simulated networks will also be provided.

## Advanced usage
The scripts in the `scripts/`-folder show how the graphs are created internally.
Users who want to create networks beyond the definition of `PATCH` presented here, should have a look at the documentation of the parent [NetIn package](https://cshvienna.github.io/NetworkInequalities/).

As this is work in progress, we are working with a preliminary version of [NetIn](https://github.com/CSHVienna/NetworkInequalities/tree/erpatch).
Similar to the present repository (see the version of `netin` in [`requirements.txt`](requirements.txt)), one needs to install a specific version to have access to `PATCH`.

## Contact
In case of questions or bugs, open an issue in [github](https://github.com/mannbach/2024_visualizing_complexity_patch/issues) or contact me directly at `bachmann \at csh.ac.at`.
